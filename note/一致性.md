# 事务一致性
## 最终一致性有5种变种:
- 1.因果一致性:如果进程A在更新完某个数据后，通知了进程B，进程B后续对该数据的访问都是进程A处理后的结果，并且进程B要处理该数据，务必是进程A处理后的最新值。与此同时与进程A无关的进程C没有这样的限制。
- 2.读己之所写:进程A更新一个数据后，它自己读取总是最新的值不会读到之前的值。
- 3.会话一致性:会话一致性对于系统数据的读取限定在一个会话当中：系统能够保证一个有效的会话保证读己之所写。
- 4.单调读一致性:如果一个进程从系统中读取一个数据项某一个值后，那么系统对于进程后续的任何数据访问都不应该反回更旧的值。
- 5.单调写一致性：系统要确保来自一个进程的写操作能够被顺序执行。

## 一致性协议:
2PC（TWO-PHASE-COMMIT）和3PC二阶段提交和三阶段提交。
### 	2阶段提交：
 		1.提交事务请求
 			事务询问：协调者（可以认为leader）向参与者（follower）发送事务内容，询问是否可以提交事务，等待参与者反馈
 			执行事务：参与者执行事务，并且将Undo和Redo信息记录在事务日志当中。
 			反馈：参与者向协调者反馈事务操作。
 	2.执行事务提交
 		假如所有参与者反馈Yes响应，协调者发送提交事务请求，参与者提交事务并且反馈ack消息，协调者接收所有ack结束事务。
 		有一个参与者反馈NO响应，协调者发送rollback请求，参与者根据Undo信息执行事务的回滚。执行完毕后反馈ack消息，协调者接收到所有的ack信息后，完成事务的中断。
### 	3阶段提交：三阶段提交是二阶段提交的改良版将二阶段提交事务一分为二，形成了canCommit、preCommit和do commit三个阶段组成的事务提交协议。
		1.canCommit,协调者会向所有参与者发送一个包含事务内容的canCommit请求,询问是否可以进行事务提交操作，开始等待参与者响应,参与者接受请求后，会反馈yes or no。
    2.preCommit,协调者根据反馈决定是否可以进行事务的precommit操作,当参与者都反馈yes,进行执行事务预提交,协调者向所有参与者发送preCommit请求,并进行Prepared阶段。
      参与者接收到precommit请求，会执行事务操作，并且将undo和redo信息记录到事务日志中，并且反馈给协调者ack响应，并且等待commit或者abort命令。
      当参与者有反馈no，进行事务中断，协调者发送中abort命令。参与者接收道abort命令参与者执行中断。
    3.doCommit，协调者根据二阶段ack反馈信息，会存在两种情况，一是执行提交，协调者向参与者发送do commit命令，参与者接收到do commit命令进行事务提交，并且向协调者发送ack消息。  协调者接收到ack消息完成事务。
      有任意参与者反馈no，协调者向所有参与者发送abort请求。参与者接收到abort命令，根据阶段二的undo信息来执行回滚操作。并且发给协调者ack消息。协调者接收到ack消息后中断事务。
      
